# Spring Securityにおけるユーザ認証の設計

## 質問

Spring Securityを導入した状態でのログインについて教えてください。ユーザ情報と権限情報をRDB上に保持し、 `SecurityConfig` クラスで権限ごとにアクセス可能なパスを制御しています。現時点では、 `UserMapper` クラスはユーザ名のみでデータを検索してくるようになっています。パスワードも使って検索するような仕組みに修正する必要がありますか？必要がある場合はその修正方法、ない場合はその理由を教えてください。

## 回答

結論から言うと、**パスワードも使って検索する必要はありません**。

---

### 理由

Spring Securityの認証処理では、  
1. ユーザ名（username）でユーザ情報（UserDetails）を取得  
2. 取得したユーザ情報のパスワードと、ログインフォームから送信されたパスワードをSpring Securityが自動的に比較・検証  

という流れになります。

**ユーザ名のみで検索し、パスワードは取得したUserエンティティのフィールドとして持っていれば十分です。**  
SQLでパスワードも条件に含めてしまうと、  
- パスワードが間違っている場合に「ユーザが存在しない」扱いになり、セキュリティ上好ましくありません（ユーザ名の存在有無が推測されやすくなるため）。
- Spring Securityのパスワード検証機能が使えなくなります。

---

### まとめ

- **ユーザ名のみで検索し、パスワードはエンティティのフィールドとして取得する**  
- **パスワードで検索条件を追加する必要はありません**  
- **現状の設計で問題ありません**（`UserMapper.findByUsername` でOK）

---

#### 参考
- Spring Security公式ドキュメント: [UserDetailsService](https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetailsService.html)
- [Spring Securityでの認証の流れ](https://spring.pleiades.io/spring-security/site/docs/current/reference/html5/#servlet-authentication)

